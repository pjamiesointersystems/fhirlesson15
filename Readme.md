# Lesson 15: Creating and Implementing Custom FHIR Extensions and Profiles

This lab-based lesson guides learners through the process of designing, creating, and publishing custom FHIR extensions and profiles using FHIR Shorthand (FSH), SUSHI, and the HL7 IG Publisher. The lesson emphasizes real-world clinical use cases, including preventive care risk classification and capturing heart rate recovery data, aligning closely with HL7 FHIR implementation best practices.

## 🚀 Objectives

By the end of this lesson, you will be able to:

- Understand and apply FHIR Shorthand (FSH) syntax to define profiles and extensions.
- Compile FSH into FHIR artifacts using SUSHI.
- Build and publish a browsable Implementation Guide (IG) using HL7’s IG Publisher and Jekyll.
- Solve realistic healthcare interoperability challenges by modeling them in FHIR.

---

## 🧩 Key Concepts

### What is FHIR Shorthand (FSH)?
- A domain-specific language created by the MITRE Corporation (2019).
- Simplifies authoring of FHIR artifacts (profiles, extensions, value sets).
- SUSHI (the FSH compiler) converts `.fsh` into JSON FHIR resources.

### Why Use FSH?
- **Declarative & Readable**: Easier than JSON/XML editing.
- **Modular Development**: Suits collaborative workflows.
- **Easy Change Tracking**: Perfect for version control.
- **Tooling Support**: Strong ecosystem via VS Code plugin and validation tools.

---

## 🛠️ Tools Required

| Tool | Description |
|------|-------------|
| [Node.js](https://nodejs.org/) | Required runtime for npm |
| SUSHI | `npm install -g fsh-sushi` – FSH compiler |
| GoFSH | `npm install -g gofsh` – FHIR to FSH decompiler |
| [VS Code](https://code.visualstudio.com/) | Recommended editor |
| FSH Plugin | Enables syntax highlighting and validation |
| [Jekyll](https://jekyllrb.com/) | Required to build and preview IGs |
| HL7 IG Publisher | Java-based tool for IG site generation |

---

## 📂 Lab Challenges

### 🔸 Challenge One: Mandatory Extension for Patient Risk

**Scenario**: Rochester Health's new CMO mandates patient risk classification to improve outcomes via preventive care.

- **Extension Name**: `HealthRisk`
- **ValueSet**: Low, Medium, High
- **Cardinality**: `1..1` (mandatory for all Patient records)
- **Enforced via**: Custom `Patient` profile, validated with `$validate`

### 🔸 Challenge Two: Heart Rate Recovery (HRR)

**Objective**: Capture detailed heart rate recovery post-exercise.

- **Profile**: `HRRProfile` (derived from `Observation`)
- **Extension**: `InterpretationCertainty`
- **ValueSet**: 10s, 20s, …, 60s HRR descriptors
- **SNOMED CT Codes**:
  - 415584804: Suspected
  - 410592001: Probably Present
  - 410535003: Confirmed Present

---

## 📘 Example Syntax

```fsh
Profile: MyPatientProfile
Parent: Patient
Id: my-patient-profile
* birthDate 1..1
* identifier 1..*
* extension contains http://hl7.org/fhir/StructureDefinition/patient-genderIdentity named genderIdentity 0..1
.
├── fsh/
│   ├── profiles/
│   ├── extensions/
│   ├── valueSets/
│   ├── examples/
│   └── index.fsh
├── output/
│   └── assets/         # IG artifacts generated by SUSHI
├── ig.ini              # IG Publisher config
├── package.json
└── README.md


java -jar publisher.jar -ig ig.ini
📚 Resources
📘 FHIR Shorthand Official Docs

💻 FSH Online

🛠️ FHIR IG Publisher

📺 YouTube: Creating an IG with FHIR Shorthand

🙏 Acknowledgements
Created by:

Patrick W. Jamieson, M.D. – Technical Product Manager

Russ Leftwich, M.D. – Senior Clinical Advisor, Interoperability

With thanks to the FSH community and HL7 contributors.